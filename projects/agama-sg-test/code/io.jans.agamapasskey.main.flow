Flow io.jans.agamapasskey.main
     Basepath ""
     Configs conf
Log "@info Flow started.."
authService = Call io.jans.as.server.service.AuthenticationService#class
cdiUtil = Call io.jans.service.cdi.util.CdiUtil#bean authService
loginResponse = {}
Repeat 3 times max
     loginResponse = RRF "main.ftlh" loginResponse
     loginResponse.success = Call cdiUtil authenticate loginResponse.username loginResponse.password
     loginResponse.uid = loginResponse.username
     When loginResponse.success is true
          userData = Call io.jans.agamapasskey.IdentityProcessor#accountFromUid loginResponse.uid
          obj = Trigger io.jans.agamapasskey.credsEnrollment userData conf true null
          When obj.success is true
     it_ihebu = { success: false, error: "Your error message here" }
     Finish it_ihebu